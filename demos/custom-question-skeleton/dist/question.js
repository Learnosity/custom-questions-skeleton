(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=function(){function t(e,n){var i,r,a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.init=e,this.events=e.events,this.lrnUtils=n,this.el=e.$el.get(0),this.runResult=null===(i=e.response)||void 0===i?void 0:i.runResult,this.latestCode=null===(r=e.response)||void 0===r?void 0:r.latestCode,this.render().then((function(){a.handleEvents(),"initial"===e.state||("resume"===e.state?a.latestCode&&a.editor&&a.editor.setFileContents(a.latestCode.files):"review"===e.state&&(a.latestCode&&a.editor&&(a.editor.setFileContents(a.latestCode.files),a.attemptSubmission().then((function(){return a.updateValidationUI()}))),e.getFacade().disable()))})).catch((function(e){console.error("Embed failed to load:",e)})).finally((function(){a.events.trigger("ready")}))}var n,i;return n=t,i=[{key:"render",value:function(){var e,t,n=this,i=this.init.question,r=i.challengeId,a=i.embedClientKey,o=i.language,s="//www.qualified.io/embed.js",l=function(e){return n.el.innerHTML='\n          <div class="alert alert-warning" role="alert">'.concat(e,"</div>"),Promise.resolve()};if(null==a||!a.trim())return l("Configuration issue: Missing embedClientKey");if(null==r||!r.trim())return l("\n          Please provide a Qualified Challenge ID (from the challenge's URL)\n        ");if(null==o||!o.trim())return l("Please provide a language");var d=new Promise((function(n,i){e=n,t=i})),u=this,c=!0,f=setTimeout((function(){t("Embed failed to load in 8 seconds")}),8e3),v={options:{language:o,embedClientKey:a,mode:"review"===this.init.state?"runonly":null,hideActions:"review"===this.init.state,hideTabs:[]},onLoaded:function(t){t.manager,t.editor,t.challengeId,t.data,clearTimeout(f),e()},onChange:function(e){e.manager,e.editor,e.challengeId;var t=e.data;c?c=!1:(u.latestCode=t,u.saveToLearnosity())},onRun:function(e){e.manager,e.editor,e.challengeId;var t=e.data;"attempt"===t.type&&(u.runResult=t,u.saveToLearnosity())}};if(document.querySelector('script[src="'.concat(s,'"]')))return this.createEmbedEditor(v,r),d;var h=document.createElement("script");return h.addEventListener("load",(function(){n.createEmbedEditor(v,r)})),h.src=s,document.body.append(h),d}},{key:"createEmbedEditor",value:function(e,t){this.el.innerHTML='\n      <div class="'.concat("lrn-custom-question",' lrn-response-validation-wrapper">\n        <div class="lrn_response_input">\n          <div class="qualified-embed"></div>\n        </div>\n      </div>');var n=window.QualifiedEmbed.init(e),i=this.el.querySelector(".qualified-embed");this.editor=n.createEditor({node:i,challengeId:t});var r=i.querySelector("iframe");r.style.width="100%",r.style.height="400px"}},{key:"attemptSubmission",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{tries:10,delayMs:1e3},n=t.tries,i=t.delayMs,r=function(e){return new Promise((function(t){return setTimeout(t,e)}))},a=!1,o=Promise.resolve(),s=function(t){o=o.then((function(){if(!a)return r(i).then((function(){return e.editor.attempt()}))})).then((function(){a=!0})).catch((function(){if(t>=n-1)throw Error("Runs failed on all of ".concat(n," tries"))}))},l=0;l<n;l++)s(l);return o}},{key:"saveToLearnosity",value:function(){this.events.trigger("changed",{runResult:this.runResult,latestCode:this.latestCode})}},{key:"updateValidationUI",value:function(){var e=this.init.getFacade().getScore(),t=this.el.querySelector(".lrn_response_input");t.classList.remove("lrn_incorrect","lrn_correct"),t.classList.add(e.score<e.max_score?"lrn_incorrect":"lrn_correct")}},{key:"handleEvents",value:function(){var e=this;this.events.on("validate",(function(t){"review"!==e.init.state&&e.updateValidationUI()}))}}],i&&e(n.prototype,i),t}();LearnosityAmd.define([],(function(){return{Question:t}}))})();